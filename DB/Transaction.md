# 트랜잭션

## 트랜잭션 개념
<p>
금융거래로 예를들어 돈을 이체 한다고 할때 보내는쪽의 금액감소, 받는쪽의 금액 증가 이 두개의 거래가 하나의 작업처럼 수행되어야한다. 이렇게 수행결과를 DB에 입력할때 모든 작업이 정상적으로 수행되서 DB에 반영하는 것을 커밋(commit), 작업 중 실패가 발생하여 전체 작업 결과를 전으로 되돌리는 것을 롤백(Rollback)이라고 한다.
</p>


## ACID
트랜잭션은 ACID라 하는 4가지 특성을 보장해야한다. 
* 원자성(Atomicity)
    * 트랜잭션 안에서 수행되는 작업은 마치 하나의 작업처럼 모두 성공, 실패해야한다.
* 일관성(Consistency)
    * 모든 트랜잭션은 일관성 있는 데이터베이스 상태를 유지해야한다.
* 격리성(Isolation)
    * 동시에 실행되는 트랜잭션들이 각자 영향을 미치지 않도록 격리한다. 동시에 같은 데이터를 수정하지 못하게 한다. 
    * 동시성과 격리성은 성능 문제로 트랜잭션 격리 수준을 선택 가능하다.
* 지속성(Durability)
    * 중간에 시스템에 문제가 발생해도 트랜잭션의 내용이 복구되야한다. 

## 트랜잭션 격리 수준
-> 아래로 갈수록 데이터 무결성이 유지되나 동시성이 떨어진다.
* READ UNCOMMITED
    * 각 트랜잭션에 변경내용의 `commit`, `rollback`여부에 상관 없이 다른 트랙잭션에서 데이터를 쓸 수 있다. 
    * 다른 트랜잭션의 변경사항이 `rollback`될 경우 존재하지 않는 데이터를 조회할 가능성이 있다. 
* READ COMMITTED
    * `커밋된 데이터만 읽을 수 있는 격리수준`
    * 특정 트랜잭션에서 데이터가 변경됐지만 아직 커밋되기전이라면 다른 트랜잭션에서 해당 데이터에 조회결과는 트랜잭션 시작 전의 데이터가 조회된다. 
* REPEATABLE READ
    * MySQL의 Inno DB에서 기본으로 사용하는 트랜잭션 격리 수준 
    * 트랜잭션 범위 내에서 조회한 내용의 항상 동일함을 보장하는 트랜잭션 
    * 트랜잭션 마다 고유ID가 있고 현재 트랜잭션의 ID보다 이전의 트랜잭션의 변경사항만 볼 수 있다. 이러한 방식을 `MVCC`라 한다.
* SERIALIZABLE
    * 모든 작업을 하나의 트랜잭션에서 처리하는 것처럼 동작하는 레벨이 가장 높은 격리수준
    * 트랜잭션에서 읽고 쓰는 데이터를 다른 트랜잭션에서 접근 할 수 없다. `DeadLock`에 걸릴 가능성이 있다.
 

